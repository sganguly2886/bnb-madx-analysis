# Python Analysis Scripts

This folder contains all Python scripts used to process MAD-X Twiss outputs,
extract optical functions, fit emittance and momentum spread, predict the
target beam spot size, and generate all final figures for the BNB narrow beam
optics study.

These scripts form the computational backbone of the full analysis pipeline.

---

## 1. Twiss Processing and Optics Extraction

These scripts read Twiss output files generated by MAD-X and extract optical
functions at the wire chambers.

### Main Script

- plot_twiss_updated.py  

This script extracts:

- Horizontal beta function (beta_x)
- Vertical beta function (beta_y)
- Horizontal dispersion (D_x)
- Vertical dispersion (D_y)

at the wire chambers:

- MW873
- MW875
- MW876

Outputs are written as CSV files to:

3_results/csv/

Examples of outputs:

- betax_vs_Q873_current.csv
- dispersion_vs_Q873_current.csv
- Corresponding HQ874 and HQ875 CSV files

---

## 2. Emittance and Momentum Spread Fitting

### Main Script

- analyze_emittance_dispersion.py  

This script solves the beam size model:

sigma^2 = epsilon * beta + (sigma_delta * D)^2

where:

- sigma = RMS beam size  
- epsilon = geometric RMS emittance  
- beta = beta function  
- sigma_delta = RMS fractional momentum spread  
- D = dispersion  

The script extracts:

- epsilon_x
- epsilon_y
- sigma_delta

Outputs:

- Emittance CSV files
- Momentum spread CSV files

Examples:

- emittance_vs_Q873_current.csv
- momentum_spread_vs_Q873_current.csv
- Corresponding HQ874 and HQ875 files

All outputs are saved in:

3_results/csv/

---

## 3. Target Beam Spot Size Prediction

### Main Script

- cal_spotsize.py  

This script propagates the extracted beam parameters to the BNB target
(approximately 207 m from the reference point) and computes:

- sigma_x_target
- sigma_y_target
- Effective 2D beam spot area:
  A = sigma_x_target * sigma_y_target

Outputs:

- target_sigma_prediction_scaled_D_Q873.csv
- target_sigma_prediction_scaled_D_Q874.csv
- target_sigma_prediction_scaled_D_Q875.csv

These files contain predicted horizontal and vertical beam sizes at the target,
as well as the effective beam spot area.

---

## 4. Plotting and Visualization Scripts

These scripts generate all physics plots used in the analysis:

- plot_betax_dx.py  
- plot_betx_dx_HQ873_874_joint_variation.py  
- plot_fixed_betx_vs_HQ875_current.py  
- plot_twiss_betx_only.py  
- plot_twiss_updated.py  
- Additional supporting plotting scripts

All figures are saved to:

3_results/figures/

These include:

- Beta-function scan plots
- Dispersion scan plots
- Emittance and momentum spread plots
- Wire chamber beam size plots
- Target beam spot optimization plots

---

## 5. Automated Scan Execution Scripts

These scripts automatically generate modified MAD-X lattice files and run
systematic optics scans:

- run_HQ873.py  
- run_HQ874.py  
- run_HQ875.py  
- run_strength.py  
- run_strength1.py  
- run_strength_HQ873_874_with_betx_variation.py  

These scripts:

- Read the master baseline lattice (bnbnew.madx)
- Apply current or K1 variations
- Write new modified MAD-X input files
- Execute MAD-X automatically
- Generate corresponding Twiss output files

Outputs are stored in:

1_twiss_outputs/

---

## Software Requirements

- Python 3.8 or newer
- NumPy
- Pandas
- Matplotlib

---

## Important Notes

- These scripts assume that MAD-X Twiss files already exist in:
  1_twiss_outputs/

- The full physics chain is:

MAD-X lattices  
→ Twiss outputs  
→ Optics extraction  
→ Emittance & momentum fitting  
→ Target beam spot prediction  
→ Final physics plots  

- All final scientific conclusions in this repository are derived from the
outputs of these scripts.
